<!DOCTYPE html>

<html>

<head>

<title>谈银青DiSanFangAar</title>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<style type="text/css">

/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */

/* Author: Nicolas Hery - http://nicolashery.com */

/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */

/* Source: https://github.com/nicolahery/markdownpad-github */



/* RESET

=============================================================================*/



html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {

  margin: 0;

  padding: 0;

  border: 0;

}



/* BODY

=============================================================================*/



body {

  font-family: Helvetica, arial, freesans, clean, sans-serif;

  font-size: 14px;

  line-height: 1.6;

  color: #333;

  background-color: #fff;

  padding: 20px;

  max-width: 960px;

  margin: 0 auto;

}



body>*:first-child {

  margin-top: 0 !important;

}



body>*:last-child {

  margin-bottom: 0 !important;

}



/* BLOCKS

=============================================================================*/



p, blockquote, ul, ol, dl, table, pre {

  margin: 15px 0;

}



/* HEADERS

=============================================================================*/



h1, h2, h3, h4, h5, h6 {

  margin: 20px 0 10px;

  padding: 0;

  font-weight: bold;

  -webkit-font-smoothing: antialiased;

}



h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {

  font-size: inherit;

}



h1 {

  font-size: 28px;

  color: #000;

}



h2 {

  font-size: 24px;

  border-bottom: 1px solid #ccc;

  color: #000;

}



h3 {

  font-size: 18px;

}



h4 {

  font-size: 16px;

}



h5 {

  font-size: 14px;

}



h6 {

  color: #777;

  font-size: 14px;

}



body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {

  margin-top: 0;

  padding-top: 0;

}



a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {

  margin-top: 0;

  padding-top: 0;

}



h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {

  margin-top: 10px;

}



/* LINKS

=============================================================================*/



a {

  color: #4183C4;

  text-decoration: none;

}



a:hover {

  text-decoration: underline;

}



/* LISTS

=============================================================================*/



ul, ol {

  padding-left: 30px;

}



ul li > :first-child, 

ol li > :first-child, 

ul li ul:first-of-type, 

ol li ol:first-of-type, 

ul li ol:first-of-type, 

ol li ul:first-of-type {

  margin-top: 0px;

}



ul ul, ul ol, ol ol, ol ul {

  margin-bottom: 0;

}



dl {

  padding: 0;

}



dl dt {

  font-size: 14px;

  font-weight: bold;

  font-style: italic;

  padding: 0;

  margin: 15px 0 5px;

}



dl dt:first-child {

  padding: 0;

}



dl dt>:first-child {

  margin-top: 0px;

}



dl dt>:last-child {

  margin-bottom: 0px;

}



dl dd {

  margin: 0 0 15px;

  padding: 0 15px;

}



dl dd>:first-child {

  margin-top: 0px;

}



dl dd>:last-child {

  margin-bottom: 0px;

}



/* CODE

=============================================================================*/



pre, code, tt {

  font-size: 12px;

  font-family: Consolas, "Liberation Mono", Courier, monospace;

}



code, tt {

  margin: 0 0px;

  padding: 0px 0px;

  white-space: nowrap;

  border: 1px solid #eaeaea;

  background-color: #f8f8f8;

  border-radius: 3px;

}



pre>code {

  margin: 0;

  padding: 0;

  white-space: pre;

  border: none;

  background: transparent;

}



pre {

  background-color: #f8f8f8;

  border: 1px solid #ccc;

  font-size: 13px;

  line-height: 19px;

  overflow: auto;

  padding: 6px 10px;

  border-radius: 3px;

}



pre code, pre tt {

  background-color: transparent;

  border: none;

}



kbd {

    -moz-border-bottom-colors: none;

    -moz-border-left-colors: none;

    -moz-border-right-colors: none;

    -moz-border-top-colors: none;

    background-color: #DDDDDD;

    background-image: linear-gradient(#F1F1F1, #DDDDDD);

    background-repeat: repeat-x;

    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;

    border-image: none;

    border-radius: 2px 2px 2px 2px;

    border-style: solid;

    border-width: 1px;

    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;

    line-height: 10px;

    padding: 1px 4px;

}



/* QUOTES

=============================================================================*/



blockquote {

  border-left: 4px solid #DDD;

  padding: 0 15px;

  color: #777;

}



blockquote>:first-child {

  margin-top: 0px;

}



blockquote>:last-child {

  margin-bottom: 0px;

}



/* HORIZONTAL RULES

=============================================================================*/



hr {

  clear: both;

  margin: 15px 0;

  height: 0px;

  overflow: hidden;

  border: none;

  background: transparent;

  border-bottom: 4px solid #ddd;

  padding: 0;

}



/* TABLES

=============================================================================*/



table th {

  font-weight: bold;

}



table th, table td {

  border: 1px solid #ccc;

  padding: 6px 13px;

}



table tr {

  border-top: 1px solid #ccc;

  background-color: #fff;

}



table tr:nth-child(2n) {

  background-color: #f8f8f8;

}



/* IMAGES

=============================================================================*/



img {

  max-width: 100%

}

</style>

<style type="text/css">

.highlight  { background: #ffffff; }

.highlight .c { color: #999988; font-style: italic } /* Comment */

.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */

.highlight .k { font-weight: bold } /* Keyword */

.highlight .o { font-weight: bold } /* Operator */

.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */

.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */

.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */

.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */

.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */

.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */

.highlight .ge { font-style: italic } /* Generic.Emph */

.highlight .gr { color: #aa0000 } /* Generic.Error */

.highlight .gh { color: #999999 } /* Generic.Heading */

.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */

.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */

.highlight .go { color: #888888 } /* Generic.Output */

.highlight .gp { color: #555555 } /* Generic.Prompt */

.highlight .gs { font-weight: bold } /* Generic.Strong */

.highlight .gu { color: #aaaaaa } /* Generic.Subheading */

.highlight .gt { color: #aa0000 } /* Generic.Traceback */

.highlight .kc { font-weight: bold } /* Keyword.Constant */

.highlight .kd { font-weight: bold } /* Keyword.Declaration */

.highlight .kp { font-weight: bold } /* Keyword.Pseudo */

.highlight .kr { font-weight: bold } /* Keyword.Reserved */

.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */

.highlight .m { color: #009999 } /* Literal.Number */

.highlight .s { color: #d14 } /* Literal.String */

.highlight .na { color: #008080 } /* Name.Attribute */

.highlight .nb { color: #0086B3 } /* Name.Builtin */

.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */

.highlight .no { color: #008080 } /* Name.Constant */

.highlight .ni { color: #800080 } /* Name.Entity */

.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */

.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */

.highlight .nn { color: #555555 } /* Name.Namespace */

.highlight .nt { color: #000080 } /* Name.Tag */

.highlight .nv { color: #008080 } /* Name.Variable */

.highlight .ow { font-weight: bold } /* Operator.Word */

.highlight .w { color: #bbbbbb } /* Text.Whitespace */

.highlight .mf { color: #009999 } /* Literal.Number.Float */

.highlight .mh { color: #009999 } /* Literal.Number.Hex */

.highlight .mi { color: #009999 } /* Literal.Number.Integer */

.highlight .mo { color: #009999 } /* Literal.Number.Oct */

.highlight .sb { color: #d14 } /* Literal.String.Backtick */

.highlight .sc { color: #d14 } /* Literal.String.Char */

.highlight .sd { color: #d14 } /* Literal.String.Doc */

.highlight .s2 { color: #d14 } /* Literal.String.Double */

.highlight .se { color: #d14 } /* Literal.String.Escape */

.highlight .sh { color: #d14 } /* Literal.String.Heredoc */

.highlight .si { color: #d14 } /* Literal.String.Interpol */

.highlight .sx { color: #d14 } /* Literal.String.Other */

.highlight .sr { color: #009926 } /* Literal.String.Regex */

.highlight .s1 { color: #d14 } /* Literal.String.Single */

.highlight .ss { color: #990073 } /* Literal.String.Symbol */

.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */

.highlight .vc { color: #008080 } /* Name.Variable.Class */

.highlight .vg { color: #008080 } /* Name.Variable.Global */

.highlight .vi { color: #008080 } /* Name.Variable.Instance */

.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */

.pl-c {

    color: #969896;

}



.pl-c1,.pl-mdh,.pl-mm,.pl-mp,.pl-mr,.pl-s1 .pl-v,.pl-s3,.pl-sc,.pl-sv {

    color: #0086b3;

}



.pl-e,.pl-en {

    color: #795da3;

}



.pl-s1 .pl-s2,.pl-smi,.pl-smp,.pl-stj,.pl-vo,.pl-vpf {

    color: #333;

}



.pl-ent {

    color: #63a35c;

}



.pl-k,.pl-s,.pl-st {

    color: #a71d5d;

}



.pl-pds,.pl-s1,.pl-s1 .pl-pse .pl-s2,.pl-sr,.pl-sr .pl-cce,.pl-sr .pl-sra,.pl-sr .pl-sre,.pl-src,.pl-v {

    color: #df5000;

}



.pl-id {

    color: #b52a1d;

}



.pl-ii {

    background-color: #b52a1d;

    color: #f8f8f8;

}



.pl-sr .pl-cce {

    color: #63a35c;

    font-weight: bold;

}



.pl-ml {

    color: #693a17;

}



.pl-mh,.pl-mh .pl-en,.pl-ms {

    color: #1d3e81;

    font-weight: bold;

}



.pl-mq {

    color: #008080;

}



.pl-mi {

    color: #333;

    font-style: italic;

}



.pl-mb {

    color: #333;

    font-weight: bold;

}



.pl-md,.pl-mdhf {

    background-color: #ffecec;

    color: #bd2c00;

}



.pl-mdht,.pl-mi1 {

    background-color: #eaffea;

    color: #55a532;

}



.pl-mdr {

    color: #795da3;

    font-weight: bold;

}



.pl-mo {

    color: #1d3e81;

}

.task-list {

padding-left:10px;

margin-bottom:0;

}



.task-list li {

    margin-left: 20px;

}



.task-list-item {

list-style-type:none;

padding-left:10px;

}



.task-list-item label {

font-weight:400;

}



.task-list-item.enabled label {

cursor:pointer;

}



.task-list-item+.task-list-item {

margin-top:3px;

}



.task-list-item-checkbox {

display:inline-block;

margin-left:-20px;

margin-right:3px;

vertical-align:1px;

}

</style>

</head>

<body>

<h1 id="2017-06-09">2017 06 09</h1>
<p><a href="http://pan.baidu.com/disk/home?errno=0&amp;errmsg=Auth%20Login%20Sucess&amp;&amp;bduss=&amp;ssnerror=0&amp;#list/vmode=list&amp;path=%2F%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E5%A4%B9%2F%E5%AE%89%E5%8D%93%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93%2FMarkDown%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3" title="查看">文档地址</a> —— <a href="http://pan.baidu.com/disk/home?errno=0&amp;errmsg=Auth%20Login%20Sucess&amp;&amp;bduss=&amp;ssnerror=0&amp;#list/vmode=list&amp;path=%2F%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E5%A4%B9%2F%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%2F%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9A%84demo" title="查看">源文件相关</a> ——  <a href="https://tanyinqing.github.io/">个人首页</a></p>
<ul>
<li><h3 id="-h1-id-1-h1-">创建  <h1 id="1"></h1></h3>
</li><li><h3 id="-101-demo-102-">高德地图→<a href="#101">高德定位说明与链接</a>→<a href="#102">高德定位demo说明</a></h3>
</li><li><h3 id="-demo-3-103-4-104-">第三方的demo →<a href="#103">3. </a>→<a href="#104">4. </a></h3>
</li></ul>
<p>参考文档<br><a href="5%9D%97" title="查看">订单</a></p>
<h1 id="101">1. 说明与链接</h1>

<p><a href="#1">返回目录</a></p>
<p><a href="http://pan.baidu.com/disk/home?errno=0&amp;errmsg=Auth%20Login%20Sucess&amp;&amp;bduss=&amp;ssnerror=0&amp;#list/vmode=list&amp;path=%2F%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E5%A4%B9%2F%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%9D%97%2F%E7%AC%AC%E4%B8%89%E6%96%B9%E7%9A%84demo%2F%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE">高德demo的源码地址</a><br>这个软件不要加载任何的图片类的信息，占位置太大，这个只包括最基本的信息。<br><a href="http://lbs.amap.com/api">开发指南</a>→<a href="http://lbs.amap.com/dev/key/app">控制台</a></p>
<p>获取SHA1值<br>通过Android Studio编译器获取SHA1<br>第一步、打开Android Studio的Terminal工具<br>第二步、输入命令：keytool -v -list -keystore keystore文件路径<br>本文件：keytool -v -list -keystore C:\android-sdk.android\debug.keystore<br>第三步、输入Keystore密码<br>默认密码为：android<br>别名: androiddebugkey<br>这个是studio绑定的</p>
<p>  SHA1: F9<img src="https://assets-cdn.github.com/images/icons/emoji/A3.png" alt=":A3:" title=":A3:" class="emoji" align="absmiddle" height="20" width="20">38<img src="https://assets-cdn.github.com/images/icons/emoji/79.png" alt=":79:" title=":79:" class="emoji" align="absmiddle" height="20" width="20">A7<img src="https://assets-cdn.github.com/images/icons/emoji/F4.png" alt=":F4:" title=":F4:" class="emoji" align="absmiddle" height="20" width="20">1A<img src="https://assets-cdn.github.com/images/icons/emoji/59.png" alt=":59:" title=":59:" class="emoji" align="absmiddle" height="20" width="20">9B<img src="https://assets-cdn.github.com/images/icons/emoji/FA.png" alt=":FA:" title=":FA:" class="emoji" align="absmiddle" height="20" width="20">C9<img src="https://assets-cdn.github.com/images/icons/emoji/FF.png" alt=":FF:" title=":FF:" class="emoji" align="absmiddle" height="20" width="20">24<img src="https://assets-cdn.github.com/images/icons/emoji/08.png" alt=":08:" title=":08:" class="emoji" align="absmiddle" height="20" width="20">5B<img src="https://assets-cdn.github.com/images/icons/emoji/95.png" alt=":95:" title=":95:" class="emoji" align="absmiddle" height="20" width="20">BD<img src="https://assets-cdn.github.com/images/icons/emoji/39.png" alt=":39:" title=":39:" class="emoji" align="absmiddle" height="20" width="20">45:04</p>
<p>通过exlipse获取SHA1<br>Windows：依次在 eclipse 中打开 Window -&gt; Preferances -&gt; Android -&gt; Build。<br>在用studio的编译器获得<br>keytool -v -list -keystore D:\workspace\wechat_sdk_sample_android\debug.keystore</p>
<pre><code> SHA1: 81:77:2C:60:0F:16:8D:6F:9C:B3:9B:C3:2C:83:74:18:F3:7E:35:13
</code></pre><p>定位失败：key错误。引用key绑定的debug.keystore错误，exlipse绑定的是自定义的debug.keystore。而不是默认的</p>
<p>获得key<br>首先，绝大多数App在调试时使用的签名文件（debug keystore）和最终App发布使用的签名文件（自定义的keystore）是不同的，不同签名文件的SHA1值也是不同的。下面提供几种获取SHA1值的方式：</p>
<p>输入发布版安全码  SHA1、调试版安全码 SHA1、以及 Package，</p>
<p>项目的 “AndroidManifest.xml” 文件中，添加如下代码：<br>XML</p>
<pre><code>&lt;application
         android:icon=&quot;@drawable/icon&quot;
         android:label=&quot;@string/app_name&quot; &gt;        
         &lt;!--集成地图的账号--&gt;
        &lt;meta-data
            android:name=&quot;com.amap.api.v2.apikey&quot;
            android:value=&quot;21cd04c0996abbd371a0e45f332c0c&quot; /&gt;         
&lt;/application&gt;
</code></pre><p><a href="http://lbs.amap.com/faq/top/hot-questions/249">图解如何获得key</a></p>
<p>请在application标签中声明service组件,每个app拥有自己单独的定位service。</p>
<p>集成高德包含的库文件 14.1M<br>AMap_Location_V3.5.0_20170731.jar<br>Android_Map3D_SDK_V5.2.1_20170630.jar<br>arm64-v8a文件夹下<br>libGNaviData.so<br>libGNaviMap.so<br>libGNaviMapex.so<br>libGNaviSearch.so<br>libGNaviUtils.so<br>libRoadLineRebuildAPI.so<br>armeabi文件夹<br>libGNaviData.so<br>libGNaviMap.so<br>libGNaviMapex.so<br>libGNaviSearch.so<br>libGNaviUtils.so<br>libRoadLineRebuildAPI.so<br>armeabi-v7a 文件夹<br>libGNaviData.so<br>libGNaviMap.so<br>libGNaviMapex.so<br>libGNaviSearch.so<br>libGNaviUtils.so<br>libRoadLineRebuildAPI.so<br>x86文件夹<br>libGNaviData.so<br>libGNaviMap.so<br>libGNaviMapex.so<br>libGNaviSearch.so<br>libGNaviUtils.so<br>libRoadLineRebuildAPI.so<br>x86_64 文件夹<br>libGNaviData.so<br>libGNaviMap.so<br>libGNaviMapex.so<br>libGNaviSearch.so<br>libGNaviUtils.so<br>libRoadLineRebuildAPI.so</p>
<h1 id="102">2. 高德定位demo说明</h1>

<p><a href="#1">返回目录</a></p>
<p>D:\workspace\AMapLocationDemo</p>
<h1 id="102.00">内部各页面的写法</h1>

<p><a href="#102.01">定位功能展示首页面</a><br><a href="#102.02">获取定位数据页面</a><br><a href="#102.03">H5辅助定位页面</a><br><a href="#102.04">错误码说明页面</a><br><a href="#102_05">定时唤起CPU页面</a></p>
<p>设置key和服务和Activity</p>
<pre><code> &lt;!-- 设置key --&gt;
        &lt;meta-data
            android:name=&quot;com.amap.api.v2.apikey&quot;
            android:value=&quot;3e63408136607f6e4e8053b2844e9403&quot; /&gt;
        &lt;!-- 定位需要的服务 --&gt;
        &lt;service android:name=&quot;com.amap.api.location.APSService&quot; &gt;
        &lt;/service&gt;

        &lt;activity
            android:name=&quot;com.amap.location.demo.StartActivity&quot;
            android:label=&quot;@string/app_name&quot;
            android:configChanges=&quot;keyboardHidden|orientation|screenSize&quot;
             &gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
        &lt;activity
            android:name=&quot;com.amap.location.demo.Location_Activity&quot;
            android:windowSoftInputMode=&quot;adjustResize|stateHidden&quot;
            android:configChanges=&quot;keyboardHidden|orientation|screenSize&quot;
            &gt;
        &lt;/activity&gt;
</code></pre><p>需要的权限</p>
<pre><code>&lt;!-- Normal Permissions 不需要运行时注册 --&gt;
    &lt;!--获取运营商信息，用于支持提供运营商信息相关的接口--&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;
    &lt;!--用于访问wifi网络信息，wifi信息会用于进行网络定位--&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;
    &lt;!--这个权限用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;
    &lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.CHANGE_CONFIGURATION&quot; /&gt;

    &lt;!-- 请求网络 --&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;

    &lt;!-- 不是SDK需要的权限，是示例中的后台唤醒定位需要的权限 --&gt;
    &lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;



    &lt;!-- 需要运行时注册的权限 --&gt;
    &lt;!--用于进行网络定位--&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; /&gt;
    &lt;!--用于访问GPS定位--&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;
    &lt;!--用于提高GPS定位速度--&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_LOCATION_EXTRA_COMMANDS&quot; /&gt;
    &lt;!--写入扩展存储，向扩展卡写入数据，用于写入缓存定位数据--&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;
     &lt;!--读取缓存数据--&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;

    &lt;!--用于读取手机当前的状态--&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;

    &lt;!-- 更改设置 --&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_SETTINGS&quot; /&gt;

    &lt;!-- 3.2.0版本增加 --&gt;
    &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_ADMIN&quot; /&gt;
    &lt;!-- 3.2.0版本增加--&gt;
    &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH&quot; /&gt;
</code></pre><h1 id="102.01">1. 定位功能展示首页面</h1>

<p><a href="#102.00">返回目录</a></p>
<p><img src="http://i.imgur.com/UNMMhhm.png" alt=""></p>
<p>xml布局</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:id=&quot;@+id/container&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    &gt;
    &lt;ListView
        android:id=&quot;@android:id/list&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;0dp&quot;
        android:layout_weight=&quot;1&quot; /&gt;
&lt;/LinearLayout&gt;
</code></pre><p>适配的布局</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
  android:layout_width=&quot;match_parent&quot;
  android:layout_height=&quot;wrap_content&quot;
  android:layout_margin=&quot;5dp&quot;
  android:layout_weight=&quot;1&quot;
  android:orientation=&quot;vertical&quot;&gt;
  &lt;TextView
    android:id=&quot;@+id/title&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:textSize=&quot;20sp&quot;/&gt;
  &lt;TextView
    android:id=&quot;@+id/description&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:textSize=&quot;16sp&quot;/&gt;
&lt;/LinearLayout&gt;
</code></pre><p>代码实现</p>
<pre><code>package com.amap.location.demo;

import com.amap.location.demo.view.FeatureView;

import android.app.ListActivity;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ListAdapter;
import android.widget.ListView;

/**
 * 高德定位SDK功能接口实例 更多SDK请进入官网“http://lbs.amap.com/api/”查看
 * 官方论坛：http://lbsbbs.amap.com/portal.php
 *
 * @项目名称： AMapLocationDemo2.x
 * 
 * @author hongming.wang
 * @文件名称: StartActivity.java
 * @类型名称: StartActivity
 */
public class StartActivity extends ListActivity {
    //这个是内部类
    private static class DemoDetails {
        private final int titleId;
        private final int descriptionId;
        private final Class&lt;? extends android.app.Activity&gt; activityClass;
        public DemoDetails(int titleId, int descriptionId,
                Class&lt;? extends android.app.Activity&gt; activityClass) {
            super();
            this.titleId = titleId;
            this.descriptionId = descriptionId;
            this.activityClass = activityClass;
        }
    }
//这个是内部适配器
    private static class CustomArrayAdapter extends ArrayAdapter&lt;DemoDetails&gt; {
        public CustomArrayAdapter(Context context, DemoDetails[] demos) {
            super(context, R.layout.feature, R.id.title, demos);
        }

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
            FeatureView featureView;
            if (convertView instanceof FeatureView) {
                featureView = (FeatureView) convertView;
            } else {
                featureView = new FeatureView(getContext());
            }
            DemoDetails demo = getItem(position);
            featureView.setTitleId(demo.titleId);
            featureView.setDescriptionId(demo.descriptionId);
            return featureView;
        }
    }
//这个是内部类对应的数组 是声明的变量
    private static final DemoDetails[] demos = {
            new DemoDetails(R.string.location,
                    R.string.location_dec, Location_Activity.class),
            new DemoDetails(R.string.geoFence, R.string.geoFence_dec,
                    GeoFence_Activity.class),
            new DemoDetails(R.string.assistantLocation,
                    R.string.assistantLocation_dec,
                    Assistant_Location_Activity.class),
            new DemoDetails(R.string.tools, R.string.tools_dec,
                    Tools_Activity.class),
            new DemoDetails(R.string.lastLocation, R.string.lastLocation_dec,
                    LastLocation_Activity.class),
            new DemoDetails(R.string.alarmCPU, R.string.alarmCPU_dec,
                    Alarm_Location_Activity.class),
            new DemoDetails(R.string.errorCode, R.string.errorCode_dec,
                    ErrorCode_Activity.class),
            };

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_start);
        /**
         * setApiKey必须在启动Activity或者Application的onCreate里进行， 在其他地方使用有可能无效,
         * 如果使用setApiKey设置key，则AndroidManifest.xml里的key会失效
         */
        // AMapLocationClient.setApiKey(&quot;需要更换的key&quot;);

        setTitle(R.string.title_main);
        ListAdapter adapter = new CustomArrayAdapter(
                this.getApplicationContext(), demos);
        setListAdapter(adapter);
//        permChecker = new PermissionsChecker(this);
    }

    @Override
    public void onBackPressed() {
        super.onBackPressed();
        System.exit(0);
    }

    @Override
    protected void onListItemClick(ListView l, View v, int position, long id) {
        DemoDetails demo = (DemoDetails) getListAdapter().getItem(position);
        startActivity(
                new Intent(this.getApplicationContext(), demo.activityClass));
    }

}
</code></pre><h1 id="102.02">2. 获取定位数据页面</h1>

<p><a href="#102.00">返回目录</a></p>
<p><img src="http://i.imgur.com/c5JiZfG.png" alt=""></p>
<p>xml页面</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:orientation=&quot;vertical&quot; &gt;
    &lt;!-- 单选项 --&gt;
    &lt;RadioGroup
        android:id=&quot;@+id/rg_locationMode&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:orientation=&quot;horizontal&quot; &gt;

        &lt;RadioButton
            android:id=&quot;@+id/rb_batterySaving&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_weight=&quot;1&quot;
            android:text=&quot;@string/battery_saving&quot; /&gt;

        &lt;RadioButton
            android:id=&quot;@+id/rb_deviceSensors&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_weight=&quot;1&quot;
            android:text=&quot;@string/device_sensors&quot; /&gt;

        &lt;RadioButton
            android:id=&quot;@+id/rb_hightAccuracy&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_weight=&quot;1&quot;
            android:checked=&quot;true&quot;
            android:text=&quot;@string/hight_accuracy&quot; /&gt;
    &lt;/RadioGroup&gt;
&lt;!-- 两个输入框 --&gt;
    &lt;LinearLayout
        android:id=&quot;@+id/layout_interval&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginTop=&quot;@dimen/normal_margin&quot; &gt;

        &lt;TextView
            android:id=&quot;@+id/tv_info&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/interval&quot; /&gt;

        &lt;EditText
            android:id=&quot;@+id/et_interval&quot;
            android:layout_width=&quot;130dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginLeft=&quot;@dimen/margin_middle&quot;
            android:ems=&quot;10&quot;
            android:hint=&quot;@string/defaultInteval&quot;
            android:inputType=&quot;number&quot; &gt;

            &lt;requestFocus /&gt;
        &lt;/EditText&gt;
    &lt;/LinearLayout&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot; &gt;

        &lt;TextView
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/httpTimeout&quot; /&gt;

        &lt;EditText
            android:id=&quot;@+id/et_httpTimeout&quot;
            android:layout_width=&quot;130dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginLeft=&quot;@dimen/margin_middle&quot;
            android:ems=&quot;10&quot;
            android:hint=&quot;@string/defaultHttpTimeout&quot;
            android:inputType=&quot;number&quot; &gt;

            &lt;requestFocus /&gt;
        &lt;/EditText&gt;
    &lt;/LinearLayout&gt;
&lt;!-- 三个选择框 --&gt;
    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center_vertical&quot;
        android:orientation=&quot;horizontal&quot; &gt;

        &lt;CheckBox
            android:id=&quot;@+id/cb_onceLocation&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/location_once&quot; /&gt;

        &lt;CheckBox
            android:id=&quot;@+id/cb_gpsFirst&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/gpsFirst&quot; /&gt;
    &lt;/LinearLayout&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center_vertical&quot;
        android:orientation=&quot;horizontal&quot; &gt;

        &lt;CheckBox
            android:id=&quot;@+id/cb_needAddress&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:checked=&quot;true&quot;
            android:text=&quot;@string/needAddress&quot; /&gt;

        &lt;CheckBox
            android:id=&quot;@+id/cb_cacheAble&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:checked=&quot;true&quot;
            android:text=&quot;@string/cacheAble&quot; /&gt;
    &lt;/LinearLayout&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center_vertical&quot;
        android:orientation=&quot;horizontal&quot; &gt;

        &lt;CheckBox
            android:id=&quot;@+id/cb_onceLastest&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/onceLastest&quot; /&gt;
        &lt;CheckBox
            android:id=&quot;@+id/cb_sensorAble&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/useSensor&quot; /&gt;
    &lt;/LinearLayout&gt;

&lt;/LinearLayout&gt;
</code></pre><p>以上是引用的xml 以下是下半部分</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    android:padding=&quot;@dimen/normal_margin&quot; &gt;
&lt;!-- 这个是上面的部分 --&gt;
    &lt;include layout=&quot;@layout/plugin_location_option&quot;/&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center&quot; &gt;

        &lt;Button
            android:id=&quot;@+id/bt_location&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/startLocation&quot; /&gt;
    &lt;/LinearLayout&gt;
&lt;!-- 这个是用来显示详细的信息 --&gt;
    &lt;ScrollView
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot; &gt;

        &lt;TextView
            android:id=&quot;@+id/tv_result&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginTop=&quot;@dimen/normal_margin&quot; /&gt;
    &lt;/ScrollView&gt;

&lt;/LinearLayout&gt;
</code></pre><p>定位类型对照表</p>
<p>定位成功，定位回调将按照定位结果返回如下几种响应码，用于区分本次定位的来源：<br>响应码<br>说明<br>介绍<br>0<br>定位失败<br>请通过AMapLocation.getErrorCode()方法获取错误码，并参考错误码对照表进行问题排查。<br>1<br>GPS定位结果<br>通过设备GPS定位模块返回的定位结果，精度较高，在10米－100米左右<br>2<br>前次定位结果<br>网络定位请求低于1秒、或两次定位之间设备位置变化非常小时返回，设备位移通过传感器感知。<br>4<br>缓存定位结果<br>返回一段时间前设备在同样的位置缓存下来的网络定位结果<br>5<br>Wifi定位结果<br>属于网络定位，定位精度相对基站定位会更好，定位精度较高，在5米－200米之间。<br>6<br>基站定位结果<br>纯粹依赖移动、联通、电信等移动网络定位，定位精度在500米-5000米之间。<br>8<br>离线定位结果</p>
<p>实现的代码</p>
<pre><code>package com.amap.location.demo;

import com.amap.api.location.AMapLocation;
import com.amap.api.location.AMapLocationClient;
import com.amap.api.location.AMapLocationClientOption;
import com.amap.api.location.AMapLocationClientOption.AMapLocationMode;
import com.amap.api.location.AMapLocationClientOption.AMapLocationProtocol;
import com.amap.api.location.AMapLocationListener;

import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.CompoundButton;
import android.widget.EditText;
import android.widget.RadioGroup;
import android.widget.RadioGroup.OnCheckedChangeListener;
import android.widget.TextView;

/**
 * 高精度定位模式功能演示
 *
 * @创建时间： 2015年11月24日 下午5:22:42
 * @项目名称： AMapLocationDemo2.x
 * @author hongming.wang
 * @文件名称: Hight_Accuracy_Activity.java
 * @类型名称: Hight_Accuracy_Activity
 */
public class Location_Activity extends CheckPermissionsActivity
        implements
            OnCheckedChangeListener,
            OnClickListener{
    private RadioGroup rgLocationMode;
    private EditText etInterval;
    private EditText etHttpTimeout;
    private CheckBox cbOnceLocation;
    private CheckBox cbAddress;
    private CheckBox cbGpsFirst;
    private CheckBox cbCacheAble;
    private CheckBox cbOnceLastest;
    private CheckBox cbSensorAble;
    private TextView tvResult;
    private Button btLocation;
//定位服务类。此类提供单次定位、持续定位、最后位置相关功能。
    private AMapLocationClient locationClient = null;
    //定位参数设置，通过这个类可以对定位的相关参数进行设置 
    private AMapLocationClientOption locationOption = null;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_location);
        setTitle(R.string.title_location);
//        初始化布局和监听器
        initView();

//        初始化定位
        initLocation();
    }

    //初始化控件
    private void initView(){
        rgLocationMode = (RadioGroup) findViewById(R.id.rg_locationMode);

        etInterval = (EditText) findViewById(R.id.et_interval);
        etHttpTimeout = (EditText) findViewById(R.id.et_httpTimeout);

        cbOnceLocation = (CheckBox)findViewById(R.id.cb_onceLocation);
        cbGpsFirst = (CheckBox) findViewById(R.id.cb_gpsFirst);
        cbAddress = (CheckBox) findViewById(R.id.cb_needAddress);
        cbCacheAble = (CheckBox) findViewById(R.id.cb_cacheAble);
        cbOnceLastest = (CheckBox) findViewById(R.id.cb_onceLastest);
        cbSensorAble = (CheckBox)findViewById(R.id.cb_sensorAble);

        tvResult = (TextView) findViewById(R.id.tv_result);
        btLocation = (Button) findViewById(R.id.bt_location);

        rgLocationMode.setOnCheckedChangeListener(this);
        btLocation.setOnClickListener(this);
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        destroyLocation();//销毁定位
    }

    @Override
    public void onCheckedChanged(RadioGroup group, int checkedId) {
        if (null == locationOption) {
            locationOption = new AMapLocationClientOption();
        }
//        这个是第一轮单选框
        switch (checkedId) {
            case R.id.rb_batterySaving :
                locationOption.setLocationMode(AMapLocationMode.Battery_Saving);
                break;
            case R.id.rb_deviceSensors :
                locationOption.setLocationMode(AMapLocationMode.Device_Sensors);
                break;
            case R.id.rb_hightAccuracy :
                locationOption.setLocationMode(AMapLocationMode.Hight_Accuracy);
                break;
            default :
                break;
        }

    }

    /**
     * 设置控件的可用状态
     * 当开启定位后，所有的状态是不可用的
     */
    private void setViewEnable(boolean isEnable) {
        for(int i=0; i&lt;rgLocationMode.getChildCount(); i++){
            rgLocationMode.getChildAt(i).setEnabled(isEnable);
        }
        etInterval.setEnabled(isEnable);
        etHttpTimeout.setEnabled(isEnable);
        cbOnceLocation.setEnabled(isEnable);
        cbGpsFirst.setEnabled(isEnable);
        cbAddress.setEnabled(isEnable);
        cbCacheAble.setEnabled(isEnable);
        cbOnceLastest.setEnabled(isEnable);
        cbSensorAble.setEnabled(isEnable);
    }

    @Override //但点击按钮后，对是否正在定位进行判断
    public void onClick(View v) {
        if (v.getId() == R.id.bt_location) {
            if (btLocation.getText().equals(
                    getResources().getString(R.string.startLocation))) {
                setViewEnable(false);
                btLocation.setText(getResources().getString(
                        R.string.stopLocation));
                tvResult.setText(&quot;正在定位...&quot;);
                startLocation();
            } else {
                setViewEnable(true);
                btLocation.setText(getResources().getString(
                        R.string.startLocation));
                stopLocation();
                tvResult.setText(&quot;定位停止&quot;);
            }
        }
    }

    /**
     * 初始化定位
     * 
     * @since 2.8.0
     * @author hongming.wang
     *
     */
    private void initLocation(){
        //初始化client
        locationClient = new AMapLocationClient(this.getApplicationContext());
        //这个是在初始化时设置定位参数
        locationOption = getDefaultOption();
        //设置定位参数
        locationClient.setLocationOption(locationOption);
        // 设置定位监听
        locationClient.setLocationListener(locationListener);
    }

    /**
     * 默认的定位参数
     * @since 2.8.0
     * @author hongming.wang
     *
     */
    private AMapLocationClientOption getDefaultOption(){
        AMapLocationClientOption mOption = new AMapLocationClientOption();
        mOption.setLocationMode(AMapLocationMode.Hight_Accuracy);//可选，设置定位模式，可选的模式有高精度、仅设备、仅网络。默认为高精度模式
        mOption.setGpsFirst(false);//可选，设置是否gps优先，只在高精度模式下有效。默认关闭
        mOption.setHttpTimeOut(30000);//可选，设置网络请求超时时间。默认为30秒。在仅设备模式下无效
        mOption.setInterval(2000);//可选，设置定位间隔。默认为2秒
        mOption.setNeedAddress(true);//可选，设置是否返回逆地理地址信息。默认是true
        mOption.setOnceLocation(false);//可选，设置是否单次定位。默认是false
        mOption.setOnceLocationLatest(false);//可选，设置是否等待wifi刷新，默认为false.如果设置为true,会自动变为单次定位，持续定位时不要使用
        AMapLocationClientOption.setLocationProtocol(AMapLocationProtocol.HTTP);//可选， 设置网络请求的协议。可选HTTP或者HTTPS。默认为HTTP
        mOption.setSensorEnable(false);//可选，设置是否使用传感器。默认是false
        mOption.setWifiScan(true); //可选，设置是否开启wifi扫描。默认为true，如果设置为false会同时停止主动刷新，停止以后完全依赖于系统刷新，定位位置可能存在误差
        mOption.setLocationCacheEnable(true); //可选，设置是否使用缓存定位，默认为true
        return mOption;
    }

    /**
     * 定位监听
     */
    AMapLocationListener locationListener = new AMapLocationListener() {
        @Override
        public void onLocationChanged(AMapLocation location) {
            if (null != location) {

                StringBuffer sb = new StringBuffer();
                //errCode等于0代表定位成功，其他的为定位失败，具体的可以参照官网定位错误码说明
                if(location.getErrorCode() == 0){
                    sb.append(&quot;定位成功&quot; + &quot;\n&quot;);
                    sb.append(&quot;定位类型: &quot; + location.getLocationType() + &quot;\n&quot;);
                    sb.append(&quot;经    度    : &quot; + location.getLongitude() + &quot;\n&quot;);
                    sb.append(&quot;纬    度    : &quot; + location.getLatitude() + &quot;\n&quot;);
                    sb.append(&quot;精    度    : &quot; + location.getAccuracy() + &quot;米&quot; + &quot;\n&quot;);
                    sb.append(&quot;提供者    : &quot; + location.getProvider() + &quot;\n&quot;);

                    sb.append(&quot;速    度    : &quot; + location.getSpeed() + &quot;米/秒&quot; + &quot;\n&quot;);
                    sb.append(&quot;角    度    : &quot; + location.getBearing() + &quot;\n&quot;);
                    // 获取当前提供定位服务的卫星个数
                    sb.append(&quot;星    数    : &quot; + location.getSatellites() + &quot;\n&quot;);
                    sb.append(&quot;国    家    : &quot; + location.getCountry() + &quot;\n&quot;);
                    sb.append(&quot;省            : &quot; + location.getProvince() + &quot;\n&quot;);
                    sb.append(&quot;市            : &quot; + location.getCity() + &quot;\n&quot;);
                    sb.append(&quot;城市编码 : &quot; + location.getCityCode() + &quot;\n&quot;);
                    sb.append(&quot;区            : &quot; + location.getDistrict() + &quot;\n&quot;);
                    sb.append(&quot;区域 码   : &quot; + location.getAdCode() + &quot;\n&quot;);
                    sb.append(&quot;地    址    : &quot; + location.getAddress() + &quot;\n&quot;);
                    sb.append(&quot;兴趣点    : &quot; + location.getPoiName() + &quot;\n&quot;);
                    //定位完成的时间
                    sb.append(&quot;定位时间: &quot; + Utils.formatUTC(location.getTime(), &quot;yyyy-MM-dd HH:mm:ss&quot;) + &quot;\n&quot;);
                } else {
                    //定位失败
                    sb.append(&quot;定位失败&quot; + &quot;\n&quot;);
                    sb.append(&quot;错误码:&quot; + location.getErrorCode() + &quot;\n&quot;);
                    sb.append(&quot;错误信息:&quot; + location.getErrorInfo() + &quot;\n&quot;);
                    sb.append(&quot;错误描述:&quot; + location.getLocationDetail() + &quot;\n&quot;);
                }
                //定位之后的回调时间
                sb.append(&quot;回调时间: &quot; + Utils.formatUTC(System.currentTimeMillis(), &quot;yyyy-MM-dd HH:mm:ss&quot;) + &quot;\n&quot;);

                //解析定位结果，
                String result = sb.toString();
                tvResult.setText(result);
            } else {
                tvResult.setText(&quot;定位失败，loc is null&quot;);
            }
        }
    };

    // 根据控件的选择，重新设置定位参数
    private void resetOption() {
        // 设置是否需要显示地址信息
        locationOption.setNeedAddress(cbAddress.isChecked());
        /**
         * 设置是否优先返回GPS定位结果，如果30秒内GPS没有返回定位结果则进行网络定位
         * 注意：只有在高精度模式下的单次定位有效，其他方式无效
         */
        locationOption.setGpsFirst(cbGpsFirst.isChecked());
        // 设置是否开启缓存
        locationOption.setLocationCacheEnable(cbCacheAble.isChecked());
        // 设置是否单次定位
        locationOption.setOnceLocation(cbOnceLocation.isChecked());
        //设置是否等待设备wifi刷新，如果设置为true,会自动变为单次定位，持续定位时不要使用
        locationOption.setOnceLocationLatest(cbOnceLastest.isChecked());
        //设置是否使用传感器
        locationOption.setSensorEnable(cbSensorAble.isChecked());
        //设置是否开启wifi扫描，如果设置为false时同时会停止主动刷新，停止以后完全依赖于系统刷新，定位位置可能存在误差
        //这个是第一个输入框
        String strInterval = etInterval.getText().toString();
        if (!TextUtils.isEmpty(strInterval)) {
            try{
                // 设置发送定位请求的时间间隔,最小值为1000，如果小于1000，按照1000算
                locationOption.setInterval(Long.valueOf(strInterval));
            }catch(Throwable e){
                e.printStackTrace();
            }
        }
        //这个是第二个输入框
        String strTimeout = etHttpTimeout.getText().toString();
        if(!TextUtils.isEmpty(strTimeout)){
            try{
                // 设置网络请求超时时间
                 locationOption.setHttpTimeOut(Long.valueOf(strTimeout));
            }catch(Throwable e){
                e.printStackTrace();
            }
        }
    }

    /**
     * 开始定位
     * 
     * @since 2.8.0
     * @author hongming.wang
     *
     */
    private void startLocation(){
        //根据控件的选择，重新设置定位参数
        resetOption();
        // 设置定位参数
        locationClient.setLocationOption(locationOption);
        // 启动定位
        locationClient.startLocation();
    }

    /**
     * 停止定位
     * 
     * @since 2.8.0
     * @author hongming.wang
     *
     */
    private void stopLocation(){
        // 停止定位
        locationClient.stopLocation();
    }

    /**
     * 销毁定位
     * 
     * @since 2.8.0
     * @author hongming.wang
     *
     */
    private void destroyLocation(){
        if (null != locationClient) {
            /**
             * 如果AMapLocationClient是在当前Activity实例化的，
             * 在Activity的onDestroy中一定要执行AMapLocationClient的onDestroy
             */
            locationClient.onDestroy();
            locationClient = null;
            locationOption = null;
        }
    }
}
</code></pre><h1 id="102.03">3. H5辅助定位页面</h1>

<p><a href="#102.00">返回目录</a></p>
<p><img src="http://i.imgur.com/CXuIJAd.png" alt=""></p>
<p>location.html 页面的写法</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=1.0, user-scalable=no, width=device-width&quot;&gt;
    &lt;title&gt;浏览器定位&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;http://cache.amap.com/lbs/static/main1119.css&quot;/&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;http://webapi.amap.com/maps?v=1.3&amp;key=b5713c7bcc8fe27fad9a40e32a29768d&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;http://cache.amap.com/lbs/static/addToolbar.js&quot;&gt;&lt;/script&gt;
&lt;body&gt;
&lt;div id=&#39;container&#39;&gt;&lt;/div&gt;
&lt;div id=&quot;tip&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    var map, geolocation;
    //加载地图，调用浏览器定位服务
    map = new AMap.Map(&#39;container&#39;, {
        resizeEnable: true
    });
    map.plugin(&#39;AMap.Geolocation&#39;, function() {
        geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            timeout: 10000,          //超过10秒后停止定位，默认：无穷大
            buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
            buttonPosition:&#39;RB&#39;,
            useNative:true
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition();
        AMap.event.addListener(geolocation, &#39;complete&#39;, onComplete);//返回定位信息
        AMap.event.addListener(geolocation, &#39;error&#39;, onError);      //返回定位出错信息
    });
    //解析定位结果
    function onComplete(data) {
        var str=[&#39;定位成功&#39;];
        str.push(&#39;经度：&#39; + data.position.getLng());
        str.push(&#39;纬度：&#39; + data.position.getLat());
        str.push(&#39;精度：&#39; + data.accuracy + &#39; 米&#39;);
        str.push(&#39;是否经过偏移：&#39; + (data.isConverted ? &#39;是&#39; : &#39;否&#39;));
        document.getElementById(&#39;tip&#39;).innerHTML = str.join(&#39;&lt;br&gt;&#39;);
    }
    //解析定位错误信息
    function onError(data) {
        document.getElementById(&#39;tip&#39;).innerHTML = &#39;定位失败&#39;;
    }
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>定义的xml布局</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    android:padding=&quot;@dimen/normal_margin&quot; &gt;

    &lt;LinearLayout
        android:id=&quot;@+id/layout_interval&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginTop=&quot;@dimen/normal_margin&quot;
        android:orientation=&quot;vertical&quot; 
        android:gravity=&quot;center&quot;&gt;
&lt;!-- 为的是让一个控件集中显示 --&gt;
        &lt;Button
            android:id=&quot;@+id/bt_assistant&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/startAssistantLocation&quot; /&gt;

    &lt;/LinearLayout&gt;

    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginTop=&quot;@dimen/normal_margin&quot;
        android:gravity=&quot;center&quot; &gt;

        &lt;Button
            android:id=&quot;@+id/bt_location&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/urlLocation&quot;
            android:enabled=&quot;false&quot; /&gt;

    &lt;/LinearLayout&gt;
     &lt;WebView
        android:id=&quot;@+id/webView&quot;
        android:visibility=&quot;gone&quot;
        android:layout_marginTop=&quot;@dimen/normal_margin&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
       /&gt; 
&lt;/LinearLayout&gt;
</code></pre><p>代码实现的过程</p>
<pre><code>package com.amap.location.demo;

import com.amap.api.location.AMapLocationClient;

import android.app.Activity;
import android.graphics.Bitmap;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.Window;
import android.webkit.GeolocationPermissions.Callback;
import android.webkit.JsResult;
import android.webkit.WebChromeClient;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.widget.Button;

/**
 * H5辅助定位模式功能演示
 *
 * @创建时间： 2015年11月24日 下午4:24:07 
 * @项目名称： AMapLocationDemo2.x
 * 
 * @author hongming.wang
 * @文件名称: Battery_Saving_Activity.java
 * @类型名称: Battery_Saving_Activity
 */
public class Assistant_Location_Activity extends CheckPermissionsActivity implements OnClickListener {
    private Button btAssistant;
    private Button btLocation;

    private AMapLocationClient locationClient = null;

    private WebView webView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_assistant_location);
        setTitle(R.string.title_assistantLocation);

        btAssistant = (Button) findViewById(R.id.bt_assistant);
        btLocation = (Button) findViewById(R.id.bt_location);

        locationClient = new AMapLocationClient(getApplicationContext());
        btAssistant.setOnClickListener(this);
        btLocation.setOnClickListener(this);

        initWebView();
    }

    private void initWebView(){
        webView = (WebView) findViewById(R.id.webView);

        WebSettings webSettings = webView.getSettings();
        // 允许webview执行javaScript脚本
        webSettings.setJavaScriptEnabled(true);
        // 设置是否允许定位，这里为了使用H5辅助定位，设置为false。
        //设置为true不一定会进行H5辅助定位，设置为true时只有H5定位失败后才会进行辅助定位
        webSettings.setGeolocationEnabled(false);


        webView.setWebViewClient(new WebViewClient() {

            public void onPageFinished(WebView view, String url) {
                super.onPageFinished(view, url);
            }

            public void onPageStarted(WebView view, String url, Bitmap favicon) {
                super.onPageStarted(view, url, favicon);
            }
        });

        webView.setWebChromeClient(new WebChromeClient() {
            // 处理javascript中的alert
            public boolean onJsAlert(WebView view, String url, String message,
                    final JsResult result) {
                return true;
            };

            // 处理javascript中的confirm
            public boolean onJsConfirm(WebView view, String url,
                    String message, final JsResult result) {
                return true;
            };

            // 处理定位权限请求
            @Override
            public void onGeolocationPermissionsShowPrompt(String origin,
                    Callback callback) {
                callback.invoke(origin, true, false); 
                super.onGeolocationPermissionsShowPrompt(origin, callback);
            }
            @Override
            // 设置网页加载的进度条
            public void onProgressChanged(WebView view, int newProgress) {
                Assistant_Location_Activity.this.getWindow().setFeatureInt(
                        Window.FEATURE_PROGRESS, newProgress * 100);
                super.onProgressChanged(view, newProgress);
            }

            // 设置应用程序的标题title
            public void onReceivedTitle(WebView view, String title) {
                super.onReceivedTitle(view, title);
            }
        });
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (null != locationClient) {
            locationClient.stopAssistantLocation();
            locationClient.onDestroy();
        }
        if(null != webView){
            webView.destroy();
        }
    }

    @Override
    public void onClick(View v) {
        if (v.getId() == R.id.bt_assistant) {
            if (btAssistant.getText().equals(getResources().getString(R.string.startAssistantLocation))) {
                btAssistant.setText(getResources().getString(R.string.stopAssistantLocation));
                locationClient.startAssistantLocation();
                btLocation.setEnabled(true);
            } else {
                btAssistant.setText(getResources().getString(R.string.startAssistantLocation));
                locationClient.stopAssistantLocation();
                btLocation.setEnabled(false);
                webView.setVisibility(View.GONE);
            }
        } else if (v.getId() == R.id.bt_location) {
            webView.setVisibility(View.VISIBLE);
            //浏览器定位，加载预置的H5定位页面
//            public final static String URL_H5LOCATION = &quot;file:///android_asset/location.html&quot;;
            webView.loadUrl(Utils.URL_H5LOCATION);
        }
    }
}
</code></pre><h1 id="102.04">4. 错误码说明页面</h1>

<p><a href="#102.00">返回目录</a></p>
<p>xml和页面文字的格式</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    android:padding=&quot;@dimen/normal_margin&quot; &gt;
    &lt;ScrollView
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot; 
        android:layout_marginTop=&quot;5dp&quot;&gt;

        &lt;TextView
            android:id=&quot;@+id/tv_errinfo&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/errorCodeInfo&quot;
            android:textSize=&quot;@dimen/font_34&quot;
            android:layout_marginTop=&quot;@dimen/normal_margin&quot; /&gt;
    &lt;/ScrollView&gt;

&lt;/LinearLayout&gt;


&lt;string name=&quot;errorCodeInfo&quot;&gt;
        0    定位成功。    可以在定位回调里判断定位返回成功后再进行业务逻辑运算\n
        1    一些重要参数为空，如context；    请对定位传递的参数进行非空判断\n
        2    定位失败，由于仅扫描到单个wifi，且没有基站信息。    请重新尝试\n
        3    获取到的请求参数为空，可能获取过程中出现异常。    请对所连接网络进行全面检查，请求可能被篡改\n
        4    请求服务器过程中的异常，多为网络情况差，链路不通导致    请检查设备网络是否通畅\n
        5    返回的XML格式错误，解析失败。    请稍后再试\n
        6    定位服务返回定位失败。    请将errorDetail（通过getLocationDetail()方法获取）信息通过工单系统反馈给我们\n
        7    KEY鉴权失败。    请仔细检查key绑定的sha1值与apk签名sha1值是否对应，或通过高频问题查找相关解决办法\n
        8    Android exception常规错误    请将errordetail（通过getLocationDetail()方法获取）信息通过工单系统反馈给我们\n
        9    定位初始化时出现异常。    请重新启动定位\n
        10    定位客户端启动失败。    请检查AndroidManifest.xml文件是否配置了APSService定位服务\n
        11    定位时的基站信息错误。    请检查是否安装SIM卡，设备很有可能连入了伪基站网络\n
        12    缺少定位权限。    请在设备的设置中开启app的定位权限\n
        13    定位失败，由于设备未开启WIFI模块或未插入SIM卡，且GPS当前不可用。 建议开启设备的WIFI模块，并将设备中插入一张可以正常工作的SIM卡，或者检查GPS是否开启；如果以上都内容都确认无误，请您检查App是否被授予定位权限\n
        14  GPS 定位失败，由于设备当前 GPS 状态差。 建议持设备到相对开阔的露天场所再次尝试\n
        15    定位结果被模拟导致定位失败。 如果您希望位置被模拟，请通过setMockEnable(true);方法开启允许位置模拟\n
        16     当前POI检索条件、行政区划检索条件下，无可用地理围栏。 建议调整检索条件后重新尝试，例如调整POI关键字，调整POI类型，调整周边搜区域，调整行政区关键字等\n
        17     相同的地理围栏已经存在，无需重复添加\n
        18    飞行模式下关闭了WIFI开关，请关闭飞行模式或者打开WIFI开关\n
        19    没有检查到SIM卡，并且关闭了WIFI开关，请打开WIFI开关或者插入SIM卡\n
    &lt;/string&gt;
</code></pre><h1 id="102_05">5. 定时唤起CPU页面</h1>

<p><a href="#102.00">返回目录</a></p>
<p><img src="http://i.imgur.com/DXggscn.png" alt=""></p>
<h1 id="-">知识要点</h1>
<p>1 利用 Handler Message进行消息的传递</p>
<pre><code>Handler mHandler = new Handler() {
        public void dispatchMessage(android.os.Message msg) {
            switch (msg.what) {
            //开始定位
            case Utils.MSG_LOCATION_START:
                tvReult.setText(&quot;正在定位...&quot;);
                break;
            // 定位完成
            case Utils.MSG_LOCATION_FINISH:
                AMapLocation loc = (AMapLocation) msg.obj;
                //对地址的信息进行分解
                String result = Utils.getLocationStr(loc);
                tvReult.setText(result);
                break;
            //停止定位
            case Utils.MSG_LOCATION_STOP:
                tvReult.setText(&quot;定位停止&quot;);
                break;
            default:
                break;
            }
        };
    };

// 定位监听回调的函数中发信息
    @Override
    public void onLocationChanged(AMapLocation loc) {
        if (null != loc) {
            //消息携带一个内部对象
            Message msg = mHandler.obtainMessage();
            msg.obj = loc;
            msg.what = Utils.MSG_LOCATION_FINISH;
            mHandler.sendMessage(msg);
        }
    }
</code></pre><p>2 利用内部的广播进行监听</p>
<pre><code>//内部自定义的广播接收器
    private BroadcastReceiver alarmReceiver = new BroadcastReceiver(){
        @Override
        public void onReceive(Context context, Intent intent) {
            if(intent.getAction().equals(&quot;LOCATION&quot;)){
                if(null != locationClient){
                    locationClient.startLocation();
                }
            }
        }
    };

//        注销广播接收器
        if(null != alarmReceiver){
            unregisterReceiver(alarmReceiver);
            alarmReceiver = null;
        }

//动态注册一个广播
        IntentFilter filter = new IntentFilter();
        filter.addAction(&quot;LOCATION&quot;);
        registerReceiver(alarmReceiver, filter);
</code></pre><p>3 周期性启动事件</p>
<pre><code>//这个中包含一个意图，携带一个动作LOCATION  专门有广播会接受这个动作
private Intent alarmIntent = null;
//对意图进行包装 意味着将来去做什么事
    private PendingIntent alarmPi = null;
//系统级的定时器 意味着将来去发送这个意图
    private AlarmManager alarm = null;

// 创建Intent对象，action为LOCATION
        alarmIntent = new Intent();
        alarmIntent.setAction(&quot;LOCATION&quot;);
// 定义一个PendingIntent对象，PendingIntent.getBroadcast包含了sendBroadcast的动作。
        // 也就是发送了action 为&quot;LOCATION&quot;的intent
        alarmPi = PendingIntent.getBroadcast(this, 0, alarmIntent, 0);
        // AlarmManager对象,注意这里并不是new一个对象，Alarmmanager为系统级服务
        alarm = (AlarmManager) getSystemService(ALARM_SERVICE);


if(null != alarm){
                    //设置一个闹钟，2秒之后每隔一段时间执行启动一次定位程序
                    alarm.setRepeating(AlarmManager.ELAPSED_REALTIME_WAKEUP, SystemClock.elapsedRealtime() + 2*1000,
                            alarmInterval * 1000, alarmPi);
                }
</code></pre><p>把定位返回的对象解析成字符串</p>
<pre><code>/**
     * 根据定位结果返回定位信息的字符串
     * @param location
     * @return
     */
    public synchronized static String getLocationStr(AMapLocation location){
        if(null == location){
            return null;
        }
        StringBuffer sb = new StringBuffer();
        //errCode等于0代表定位成功，其他的为定位失败，具体的可以参照官网定位错误码说明
        if(location.getErrorCode() == 0){
            sb.append(&quot;定位成功&quot; + &quot;\n&quot;);
            sb.append(&quot;定位类型: &quot; + location.getLocationType() + &quot;\n&quot;);
            sb.append(&quot;经    度    : &quot; + location.getLongitude() + &quot;\n&quot;);
            sb.append(&quot;纬    度    : &quot; + location.getLatitude() + &quot;\n&quot;);
            sb.append(&quot;精    度    : &quot; + location.getAccuracy() + &quot;米&quot; + &quot;\n&quot;);
            sb.append(&quot;提供者    : &quot; + location.getProvider() + &quot;\n&quot;);

            sb.append(&quot;速    度    : &quot; + location.getSpeed() + &quot;米/秒&quot; + &quot;\n&quot;);
            sb.append(&quot;角    度    : &quot; + location.getBearing() + &quot;\n&quot;);
            // 获取当前提供定位服务的卫星个数
            sb.append(&quot;星    数    : &quot; + location.getSatellites() + &quot;\n&quot;);
            sb.append(&quot;国    家    : &quot; + location.getCountry() + &quot;\n&quot;);
            sb.append(&quot;省            : &quot; + location.getProvince() + &quot;\n&quot;);
            sb.append(&quot;市            : &quot; + location.getCity() + &quot;\n&quot;);
            sb.append(&quot;城市编码 : &quot; + location.getCityCode() + &quot;\n&quot;);
            sb.append(&quot;区            : &quot; + location.getDistrict() + &quot;\n&quot;);
            sb.append(&quot;区域 码   : &quot; + location.getAdCode() + &quot;\n&quot;);
            sb.append(&quot;地    址    : &quot; + location.getAddress() + &quot;\n&quot;);
            sb.append(&quot;兴趣点    : &quot; + location.getPoiName() + &quot;\n&quot;);
            //定位完成的时间
            sb.append(&quot;定位时间: &quot; + formatUTC(location.getTime(), &quot;yyyy-MM-dd HH:mm:ss&quot;) + &quot;\n&quot;);
        } else {
            //定位失败
            sb.append(&quot;定位失败&quot; + &quot;\n&quot;);
            sb.append(&quot;错误码:&quot; + location.getErrorCode() + &quot;\n&quot;);
            sb.append(&quot;错误信息:&quot; + location.getErrorInfo() + &quot;\n&quot;);
            sb.append(&quot;错误描述:&quot; + location.getLocationDetail() + &quot;\n&quot;);
        }
        //定位之后的回调时间
        sb.append(&quot;回调时间: &quot; + formatUTC(System.currentTimeMillis(), &quot;yyyy-MM-dd HH:mm:ss&quot;) + &quot;\n&quot;);
        return sb.toString();
    }
</code></pre><p>xml布局</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    android:padding=&quot;@dimen/normal_margin&quot; &gt;
&lt;!-- 两个输入框 --&gt;
    &lt;LinearLayout
        android:id=&quot;@+id/layout_interval&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginTop=&quot;@dimen/normal_margin&quot; &gt;

        &lt;TextView
            android:id=&quot;@+id/tv_info&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/interval&quot; /&gt;

        &lt;EditText
            android:id=&quot;@+id/et_interval&quot;
            android:layout_width=&quot;130dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginLeft=&quot;@dimen/margin_middle&quot;
            android:ems=&quot;10&quot;
            android:hint=&quot;@string/defaultInteval&quot;
            android:inputType=&quot;number&quot; &gt;

            &lt;requestFocus /&gt;
        &lt;/EditText&gt;

    &lt;/LinearLayout&gt;
    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginTop=&quot;@dimen/normal_margin&quot; &gt;

        &lt;TextView
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/alarmInterval&quot; /&gt;

        &lt;EditText
            android:id=&quot;@+id/et_alarm&quot;
            android:layout_width=&quot;130dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginLeft=&quot;@dimen/margin_middle&quot;
            android:ems=&quot;10&quot;
            android:hint=&quot;5&quot;
            android:inputType=&quot;number&quot; &gt;
            &lt;requestFocus /&gt;
        &lt;/EditText&gt;
    &lt;/LinearLayout&gt;
&lt;!-- 一个选项框 --&gt;
    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_marginTop=&quot;@dimen/normal_margin&quot; &gt;

        &lt;CheckBox
            android:id=&quot;@+id/cb_needAddress&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:checked=&quot;true&quot;
            android:text=&quot;@string/needAddress&quot; /&gt;

        &lt;CheckBox
            android:id=&quot;@+id/cb_gpsFirst&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/gpsFirst&quot;
            android:visibility=&quot;gone&quot; /&gt;
    &lt;/LinearLayout&gt;
&lt;!-- 开始定位 --&gt;
    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center&quot; &gt;

        &lt;Button
            android:id=&quot;@+id/bt_location&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/startLocation&quot; /&gt;
    &lt;/LinearLayout&gt;

    &lt;ScrollView
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot; &gt;

        &lt;TextView
            android:id=&quot;@+id/tv_result&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginTop=&quot;@dimen/normal_margin&quot; /&gt;
    &lt;/ScrollView&gt;

&lt;/LinearLayout&gt;
</code></pre><p>代码进行实现</p>
<pre><code>package com.amap.location.demo;

import com.amap.api.location.AMapLocation;
import com.amap.api.location.AMapLocationClient;
import com.amap.api.location.AMapLocationClientOption;
import com.amap.api.location.AMapLocationClientOption.AMapLocationMode;
import com.amap.api.location.AMapLocationListener;

import android.app.Activity;
import android.app.AlarmManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.os.SystemClock;
import android.text.TextUtils;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;

/**
 * 后台唤醒定位
 * @创建时间：2016年1月8日 上午11:25:01
 * @项目名称： AMapLocationDemo2.x 
 * @author hongming.wang
 * @文件名称：Alarm_Location_Activity.java
 * @类型名称：Alarm_Location_Activity
 * @since 2.3.0
 */
public class Alarm_Location_Activity extends CheckPermissionsActivity implements
         OnClickListener, AMapLocationListener {
    private EditText etInterval;
    private EditText etAlarm;
    private CheckBox cbAddress;
    private CheckBox cbGpsFirst;
    private TextView tvReult;
    private Button btLocation;
    //定位服务类。此类提供单次定位、持续定位、最后位置相关功能。
    private AMapLocationClient locationClient = null;
    //定位参数设置，通过这个类可以对定位的相关参数进行设置 
    private AMapLocationClientOption locationOption = null;

    private Intent alarmIntent = null;
    private PendingIntent alarmPi = null;
    private AlarmManager alarm = null;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_alarm_location);
        setTitle(R.string.title_alarmCPU);

        etInterval = (EditText) findViewById(R.id.et_interval);
        etAlarm = (EditText) findViewById(R.id.et_alarm);
        cbAddress = (CheckBox) findViewById(R.id.cb_needAddress);
        cbGpsFirst = (CheckBox) findViewById(R.id.cb_gpsFirst);
        tvReult = (TextView) findViewById(R.id.tv_result);
        btLocation = (Button) findViewById(R.id.bt_location);

        btLocation.setOnClickListener(this);

        locationClient = new AMapLocationClient(this.getApplicationContext());
        locationOption = new AMapLocationClientOption();
        // 设置定位模式为高精度模式
        locationOption.setLocationMode(AMapLocationMode.Hight_Accuracy);
        // 设置定位监听
        locationClient.setLocationListener(this);

        // 创建Intent对象，action为LOCATION
        alarmIntent = new Intent();
        alarmIntent.setAction(&quot;LOCATION&quot;);
        /*意图过滤器*/
        IntentFilter ift = new IntentFilter();

        // 定义一个PendingIntent对象，PendingIntent.getBroadcast包含了sendBroadcast的动作。
        // 也就是发送了action 为&quot;LOCATION&quot;的intent
        alarmPi = PendingIntent.getBroadcast(this, 0, alarmIntent, 0);
        // AlarmManager对象,注意这里并不是new一个对象，Alarmmanager为系统级服务
        alarm = (AlarmManager) getSystemService(ALARM_SERVICE);

        //动态注册一个广播
        IntentFilter filter = new IntentFilter();
        filter.addAction(&quot;LOCATION&quot;);
        registerReceiver(alarmReceiver, filter);
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (null != locationClient) {
            /**
             * 如果AMapLocationClient是在当前Activity实例化的，
             * 在Activity的onDestroy中一定要执行AMapLocationClient的onDestroy
             */
            locationClient.onDestroy();
            locationClient = null;
            locationOption = null;
        }
//        注销广播接收器
        if(null != alarmReceiver){
            unregisterReceiver(alarmReceiver);
            alarmReceiver = null;
        }
    }

    /**
     * 设置控件的可用状态
     */
    private void setViewEnable(boolean isEnable) {
        etInterval.setEnabled(isEnable);
        etAlarm.setEnabled(isEnable);
        cbAddress.setEnabled(isEnable);
        cbGpsFirst.setEnabled(isEnable);
    }

    @Override
    public void onClick(View v) {
        if (v.getId() == R.id.bt_location) {
            if (btLocation.getText().equals(
                    getResources().getString(R.string.startLocation))) {
                setViewEnable(false);//设置控件的可用状态
                initOption();// 根据控件的选择，重新设置定位参数
                //这个是唤醒周期
                int alarmInterval = 5;
                String str = etAlarm.getText().toString();
                if(!TextUtils.isEmpty(str)){
                    alarmInterval = Integer.parseInt(str);
                }
//                按钮显示的文字发生变化
                btLocation.setText(getResources().getString(
                        R.string.stopLocation));
                // 设置定位参数
                locationClient.setLocationOption(locationOption);
                // 启动定位
                locationClient.startLocation();
//                public final static int MSG_LOCATION_START = 0;
                mHandler.sendEmptyMessage(Utils.MSG_LOCATION_START);

                if(null != alarm){
                    //设置一个闹钟，2秒之后每隔一段时间执行启动一次定位程序
                    alarm.setRepeating(AlarmManager.ELAPSED_REALTIME_WAKEUP, SystemClock.elapsedRealtime() + 2*1000,
                            alarmInterval * 1000, alarmPi);
                }
            } else {
                setViewEnable(true);
                btLocation.setText(getResources().getString(
                        R.string.startLocation));
                // 停止定位
                locationClient.stopLocation();
                mHandler.sendEmptyMessage(Utils.MSG_LOCATION_STOP);

                //停止定位的时候取消闹钟
                if(null != alarm){
                    alarm.cancel(alarmPi);
                }
            }
        }
    }

    // 根据控件的选择，重新设置定位参数
    private void initOption() {
        // 设置是否需要显示地址信息
        locationOption.setNeedAddress(cbAddress.isChecked());
        /**
         * 设置是否优先返回GPS定位结果，如果30秒内GPS没有返回定位结果则进行网络定位
         * 注意：只有在高精度模式下的单次定位有效，其他方式无效
         */
        locationOption.setGpsFirst(cbGpsFirst.isChecked());
        String strInterval = etInterval.getText().toString();
        if (!TextUtils.isEmpty(strInterval)) {
            // 设置发送定位请求的时间间隔,最小值为1000，如果小于1000，按照1000算
            locationOption.setInterval(Long.valueOf(strInterval));
        }

    }

    Handler mHandler = new Handler() {
        public void dispatchMessage(android.os.Message msg) {
            switch (msg.what) {
            //开始定位
            case Utils.MSG_LOCATION_START:
                tvReult.setText(&quot;正在定位...&quot;);
                break;
            // 定位完成
            case Utils.MSG_LOCATION_FINISH:
                AMapLocation loc = (AMapLocation) msg.obj;
                //对地址的信息进行分解
                String result = Utils.getLocationStr(loc);
                tvReult.setText(result);
                break;
            //停止定位
            case Utils.MSG_LOCATION_STOP:
                tvReult.setText(&quot;定位停止&quot;);
                break;
            default:
                break;
            }
        };
    };

    // 定位监听
    @Override
    public void onLocationChanged(AMapLocation loc) {
        if (null != loc) {
            //消息携带一个内部对象
            Message msg = mHandler.obtainMessage();
            msg.obj = loc;
            msg.what = Utils.MSG_LOCATION_FINISH;
            mHandler.sendMessage(msg);
        }
    }

    //内部自定义的广播接收器
    private BroadcastReceiver alarmReceiver = new BroadcastReceiver(){
        @Override
        public void onReceive(Context context, Intent intent) {
            if(intent.getAction().equals(&quot;LOCATION&quot;)){
                if(null != locationClient){
                    locationClient.startLocation();
                }
            }
        }
    };

}
</code></pre><h1 id="101">1. 说明</h1>

<p><a href="#1">返回目录</a></p>
<pre><code>android:theme=&quot;@style/myTheme&quot;
</code></pre><h1 id="101">1. 说明</h1>

<p><a href="#1">返回目录</a></p>
<pre><code>android:theme=&quot;@style/myTheme&quot;
</code></pre>

</body>

</html>

<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->

